# node:lts-alpine.3.15
FROM node@sha256:bb776153f81d6e931211e3cadd7eef92c811e7086993b685d1f40242d486b9bb

# Set up container environment
WORKDIR /app
ENV NODE_ENV=production

# Run application as node default user (instead of root)
RUN chown -R node:node /app
USER node

# Install dependencies
# Copy partial package.json generated by the NX build + package-lock.json
COPY ./dist/apps/websocket-gateway/package.json package-lock.json ./

RUN npm ci --no-audit --no-fund

# Copy built code
COPY ./dist/apps/websocket-gateway ./

CMD node ./main.js
